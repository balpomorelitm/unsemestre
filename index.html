<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Un semestre loco en SPAN1001</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            /* Colorful gradient background */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff758c 100%);
            background-attachment: fixed;
        }
        input.gap-input {
            border-bottom: 2px solid #cbd5e1;
            transition: all 0.3s ease;
            text-align: center;
            color: #1e293b;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.5); /* Slightly visible background for inputs */
        }
        input.gap-input:focus {
            outline: none;
            border-bottom-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
        }
        input.correct {
            border-bottom-color: #22c55e;
            color: #15803d;
            background-color: rgba(34, 197, 94, 0.1);
        }
        input.incorrect {
            border-bottom-color: #ef4444;
            color: #b91c1c;
            background-color: rgba(239, 68, 68, 0.1);
        }
        /* Shake animation for errors */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .song-line {
            line-height: 2.5rem;
            margin-bottom: 0.5rem;
        }
        /* Range Slider Styling for Audio Player */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            margin-top: -4px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
    </style>
</head>
<body class="min-h-screen flex items-start justify-center py-10 px-4">

    <div class="max-w-3xl w-full bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl overflow-hidden">
        <!-- Header -->
        <div class="bg-indigo-600 p-6 text-white text-center relative overflow-hidden">
            <!-- Background Decoration -->
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                <svg viewBox="0 0 100 100" preserveAspectRatio="none" class="w-full h-full">
                    <path d="M0 100 C 20 0 50 0 100 100 Z" fill="white" />
                </svg>
            </div>

            <div class="relative z-10">
                <h1 class="text-3xl font-bold mb-2">ðŸŽµ Un semestre loco en SPAN1001 ðŸŽµ</h1>
                <p class="text-indigo-100">Completa la canciÃ³n con las palabras que faltan.</p>
                <p class="text-sm mt-2 opacity-80 mb-6">Pista: Mira los emojis o los verbos en infinitivo.</p>

                <!-- Audio Player UI -->
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-3 flex items-center gap-4 border border-white/30 shadow-inner max-w-md mx-auto transition-all hover:bg-white/25">
                    <button id="playBtn" class="w-12 h-12 flex-shrink-0 flex items-center justify-center bg-white text-indigo-600 rounded-full shadow-lg hover:scale-105 transition-transform active:scale-95">
                        <!-- Play Icon -->
                        <svg id="playIcon" class="w-5 h-5 fill-current translate-x-0.5" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        <!-- Pause Icon -->
                        <svg id="pauseIcon" class="w-5 h-5 fill-current hidden" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </button>
                    
                    <div class="flex-1 flex flex-col justify-center">
                        <input type="range" id="progressBar" value="0" step="0.1" class="w-full h-2 bg-transparent appearance-none cursor-pointer focus:outline-none">
                        <div class="flex justify-between text-xs text-indigo-50 font-medium mt-1 px-1">
                            <span id="currentTime">0:00</span>
                            <span id="duration">0:00</span>
                        </div>
                    </div>
                </div>
                <!-- Hidden Audio Element -->
                <audio id="audioElement" src="span1001song.mp3"></audio>
            </div>
        </div>

        <!-- Content -->
        <div class="p-8 space-y-8 text-lg text-gray-800">
            
            <!-- Verse 1 -->
            <div class="song-section">
                <h3 class="text-indigo-600 font-bold text-sm uppercase tracking-wide mb-2">Verso 1</h3>
                <p class="song-line">
                    Â¡Hola a todos! Estamos en Hong Kong universidad, aquÃ­ el espaÃ±ol es nuestra nueva 
                    <input type="text" class="w-24 gap-input" data-answer="ciudad" placeholder="ðŸ™ï¸">.
                </p>
                <p class="song-line">
                    La Jefa 
                    <input type="text" class="w-24 gap-input" data-answer="RocÃ­o" placeholder="ðŸ‘©â€ðŸ«"> 
                    es la mejor, 
                    <input type="text" class="w-24 gap-input" data-answer="MartÃ­n" placeholder="ðŸ‘¨â€ðŸ«"> 
                    dibuja con mucha pasiÃ³n,
                </p>
                <p class="song-line">
                    <input type="text" class="w-24 gap-input" data-answer="Pablo" placeholder="ðŸ‘¨â€ðŸ«"> 
                    coordina, Â¡quÃ© honor! y 
                    <input type="text" class="w-24 gap-input" data-answer="Deya" placeholder="ðŸ‘©â€ðŸ«"> 
                    es genial en la lecciÃ³n.
                </p>
            </div>

            <!-- Verse 2 -->
            <div class="song-section">
                <h3 class="text-indigo-600 font-bold text-sm uppercase tracking-wide mb-2">Verso 2</h3>
                <p class="song-line">
                    Por la maÃ±ana, yo 
                    <input type="text" class="w-32 gap-input" data-answer="me levanto" placeholder="(levantarse)"> 
                    muy temprano, veo los videos de 
                    <input type="text" class="w-24 gap-input" data-answer="Ignacio" placeholder="ðŸ‘¨â€ðŸ«">,
                </p>
                <p class="song-line">
                    es como mi 
                    <input type="text" class="w-24 gap-input" data-answer="hermano" placeholder="ðŸ‘¦">. 
                    Hoy es 
                    <input type="text" class="w-24 gap-input" data-answer="viernes" placeholder="ðŸ“…"> 
                    y yo 
                    <input type="text" class="w-24 gap-input" data-answer="quiero" placeholder="(querer)"> 
                </p>
                <p class="song-line">
                    ir a Lan Kwai Fong a bailar y reÃ­r.
                </p>
                <p class="song-line">
                    Pero 
                    <input type="text" class="w-24 gap-input" data-answer="tengo" placeholder="(tener)"> 
                    un problema: Â¡Tengo una tarea de audio y mÃ¡s 
                    <input type="text" class="w-28 gap-input" data-answer="ejercicios" placeholder="ðŸ“"> 
                    un montÃ³n!
                </p>
            </div>

            <!-- Chorus -->
            <div class="song-section bg-yellow-50 p-4 rounded-xl border border-yellow-200 shadow-sm">
                <h3 class="text-yellow-700 font-bold text-sm uppercase tracking-wide mb-2">Coro</h3>
                <p class="song-line">
                    Â¡Ay, madre mÃ­a! La ciudad es 
                    <input type="text" class="w-20 gap-input" data-answer="frÃ­a" placeholder="â„ï¸"> 
                    pero en mi clase hay calor y 
                    <input type="text" class="w-20 gap-input" data-answer="amor" placeholder="â¤ï¸">.
                </p>
                <p class="song-line">
                    A mÃ­ me gusta mucho el espaÃ±ol, y mis 
                    <input type="text" class="w-24 gap-input" data-answer="amigos" placeholder="ðŸ‘¥"> 
                    de clase son lo mejor!
                </p>
            </div>

            <!-- Verse 3 -->
            <div class="song-section">
                <h3 class="text-indigo-600 font-bold text-sm uppercase tracking-wide mb-2">Verso 3</h3>
                <p class="song-line">
                    Nosotros vamos al Moodle 
                    <input type="text" class="w-24 gap-input" data-answer="General" placeholder="ðŸŒ">, 
                    buscar la informaciÃ³n es fundamental.
                </p>
                <p class="song-line">
                    Si hay dudas, al Moodle de Grupo 
                    <input type="text" class="w-24 gap-input" data-answer="vas" placeholder="(ir, tÃº)"> 
                    es lo mÃ¡s.
                </p>
                <p class="song-line">
                    La clase de 
                    <input type="text" class="w-32 gap-input" data-answer="conversaciÃ³n" placeholder="ðŸ—£ï¸"> 
                    es genial, hablamos con los compaÃ±eros y problemas no 
                    <input type="text" class="w-20 gap-input" data-answer="hay" placeholder="(haber)">.
                </p>
            </div>

            <!-- Bridge -->
            <div class="song-section">
                <h3 class="text-indigo-600 font-bold text-sm uppercase tracking-wide mb-2">Puente (Bridge)</h3>
                <p class="song-line">
                    Â¡AtenciÃ³n, chicos! Pronto la 
                    <input type="text" class="w-24 gap-input" data-answer="Prueba" placeholder="ðŸ“„"> 
                    <input type="text" class="w-12 gap-input" data-answer="de" placeholder="ðŸ”—"> 
                    <input type="text" class="w-24 gap-input" data-answer="Progreso" placeholder="ðŸ“ˆ"> 
                    2 ya viene.
                </p>
                <p class="song-line">
                    Nosotros 
                    <input type="text" class="w-24 gap-input" data-answer="tenemos" placeholder="(Tener+nosotros)"> 
                    que estudiar un montÃ³n, los verbos, el vocabulario y la lecciÃ³n.
                </p>
            </div>

            <!-- Outro -->
            <div class="song-section">
                <h3 class="text-indigo-600 font-bold text-sm uppercase tracking-wide mb-2">Outro</h3>
                <p class="song-line">
                    Pero hoy en Hong Kong estamos contentos, Â¡Un semestre 
                    <input type="text" class="w-24 gap-input" data-answer="loco" placeholder="ðŸ¤ª">, 
                    al 
                    <input type="text" class="w-24 gap-input" data-answer="mil" placeholder="1000"> 
                    por ciento!
                </p>
                <p class="song-line font-bold text-indigo-600 mt-4">
                    Â¡Hasta el prÃ³ximo semestre!!!!!
                </p>
            </div>

        </div>

        <!-- Footer / Controls -->
        <div class="bg-white/80 backdrop-blur p-6 border-t flex flex-col sm:flex-row justify-between items-center gap-4">
            <div class="text-gray-700 font-medium">
                PuntuaciÃ³n: <span id="score" class="font-bold text-indigo-600">0</span> / <span id="total">0</span>
            </div>

            <!-- Accent toggle -->
            <label class="flex items-center space-x-2 text-gray-700 font-medium cursor-pointer hover:bg-gray-100 px-3 py-1 rounded transition-colors select-none">
                <input type="checkbox" id="ignoreAccents" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300" checked>
                <span>Ignorar acentos</span>
            </label>

            <div class="flex gap-2">
                <button onclick="resetExercise()" class="px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors">
                    Reiniciar
                </button>
                <button onclick="checkAnswers()" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:scale-105">
                    Comprobar (Check)
                </button>
            </div>
        </div>
    </div>

    <!-- Celebration Modal -->
    <div id="modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm mx-4 animate-bounce-in transform scale-100 transition-transform">
            <div class="text-6xl mb-4">ðŸŽ‰</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Â¡Felicidades!</h2>
            <p class="text-gray-600 mb-6">Has completado la canciÃ³n correctamente.</p>
            <button onclick="closeModal()" class="w-full py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-bold shadow-md">
                Cerrar
            </button>
        </div>
    </div>

    <script>
        const inputs = document.querySelectorAll('.gap-input');
        const scoreDisplay = document.getElementById('score');
        const totalDisplay = document.getElementById('total');
        const modal = document.getElementById('modal');
        const ignoreAccentsCheckbox = document.getElementById('ignoreAccents');

        // Audio Player Elements
        const audio = document.getElementById('audioElement');
        const playBtn = document.getElementById('playBtn');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const progressBar = document.getElementById('progressBar');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');

        // --- Audio Logic ---

        // Toggle Play/Pause
        playBtn.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
            }
        });

        // Update Progress Bar
        audio.addEventListener('timeupdate', () => {
            const current = audio.currentTime;
            const duration = audio.duration;
            
            if (!isNaN(duration)) {
                progressBar.max = duration;
                progressBar.value = current;
                currentTimeEl.textContent = formatTime(current);
                durationEl.textContent = formatTime(duration);
            }
        });

        // Seek
        progressBar.addEventListener('input', () => {
            audio.currentTime = progressBar.value;
        });

        // Reset icon when song ends
        audio.addEventListener('ended', () => {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            progressBar.value = 0;
            currentTimeEl.textContent = "0:00";
        });

        // Format time (mm:ss)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }


        // --- Exercise Logic ---

        // Set total score
        totalDisplay.innerText = inputs.length;

        // Helper function to remove accents
        function normalizeString(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function checkAnswers() {
            let correctCount = 0;
            const shouldIgnoreAccents = ignoreAccentsCheckbox.checked;

            inputs.forEach(input => {
                let userAnswer = input.value.trim().toLowerCase();
                let correctAnswer = input.dataset.answer.toLowerCase();

                // If ignore accents is checked, normalize both strings
                if (shouldIgnoreAccents) {
                    userAnswer = normalizeString(userAnswer);
                    correctAnswer = normalizeString(correctAnswer);
                }

                // Remove previous styles
                input.classList.remove('correct', 'incorrect', 'shake');

                if (userAnswer === correctAnswer) {
                    input.classList.add('correct');
                    correctCount++;
                } else {
                    input.classList.add('incorrect');
                    // Trigger reflow for animation restart
                    void input.offsetWidth; 
                    input.classList.add('shake');
                }
            });

            scoreDisplay.innerText = correctCount;

            if (correctCount === inputs.length) {
                confettiEffect();
                setTimeout(() => {
                    modal.classList.remove('hidden');
                }, 500);
            }
        }

        function resetExercise() {
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('correct', 'incorrect', 'shake');
            });
            scoreDisplay.innerText = '0';
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        // Simple confetti effect for celebration
        function confettiEffect() {
            const colors = ['#667eea', '#764ba2', '#ff758c', '#fbbf24'];
            for(let i=0; i<60; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.width = '12px';
                confetti.style.height = '12px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = '50%';
                confetti.style.transition = 'top 2.5s ease-in, transform 2.5s ease-in';
                confetti.style.zIndex = '100';
                document.body.appendChild(confetti);

                setTimeout(() => {
                    confetti.style.top = '110vh';
                    confetti.style.transform = `translateX(${Math.random() * 200 - 100}px) rotate(${Math.random() * 360}deg)`;
                }, 50);

                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }
    </script>
</body>
</html>
